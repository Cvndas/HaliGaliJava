<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HaliGaliJava</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">import java.util.ArrayList;
import java.util.Scanner;
import java.util.Random;

import static java.lang.System.out;

//TIP To &lt;b&gt;Run&lt;/b&gt; code, press &lt;shortcut actionId=&quot;Run&quot;/&gt; or
// click the &lt;icon src=&quot;AllIcons.Actions.Execute&quot;/&gt; icon in the gutter.
<span class="pc" id="L9">public class Main {</span>

	public static ArrayList&lt;Participant&gt; _cpuPlayers;
	public static ArrayList&lt;Participant&gt; _aliveParticipants;
	public static Participant _player;
	private static HaliDeck _deck;
	private static Scanner _inputScanner;
	private static int _participantCount;
	public static final int CARDS_IN_DECK = 56;

	public static void main(String[] args) {
<span class="nc" id="L20">		_inputScanner = new Scanner(System.in);</span>
<span class="nc" id="L21">		InitializeGame();</span>
<span class="nc" id="L22">		PlayGame(_player);</span>
<span class="nc" id="L23">	}</span>

	private static void InitializeGame() {
<span class="nc" id="L26">		_deck = new HaliDeck();</span>
<span class="nc" id="L27">		_aliveParticipants = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L29">		System.out.println(&quot;Choose a player count. Options: 2, 3, 4 &quot;);</span>

<span class="nc" id="L31">		boolean playerCountIsValid = false;</span>
<span class="nc" id="L32">		_participantCount = -1;</span>

<span class="nc bnc" id="L34" title="All 2 branches missed.">		while (!playerCountIsValid) {</span>
<span class="nc" id="L35">			_participantCount = _inputScanner.nextInt();</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">			if (_inputScanner.hasNextLine()) {</span>
<span class="nc" id="L37">				_inputScanner.nextLine();</span>
			}
<span class="nc bnc" id="L39" title="All 6 branches missed.">			playerCountIsValid =</span>
					  (_participantCount == 2) ||
								 (_participantCount == 3) ||
								 (_participantCount == 4);
<span class="nc bnc" id="L43" title="All 2 branches missed.">			if (!playerCountIsValid) {</span>
<span class="nc" id="L44">				out.println(&quot;Invalid player count. Options: 2, 3, 4&quot;);</span>
			}

		}
<span class="nc" id="L48">		out.println(&quot;Starting a &quot; + _participantCount + &quot; player game!&quot;);</span>

		// ::: Initializing the participants. The player is participant 0.
<span class="nc" id="L51">		_player = new Participant();</span>
<span class="nc" id="L52">		_aliveParticipants.add(_player);</span>
<span class="nc" id="L53">		GiveParticipantInitialCards(_player, _participantCount);</span>

<span class="nc" id="L55">		_cpuPlayers = new ArrayList&lt;Participant&gt;(_participantCount - 1);</span>

<span class="nc bnc" id="L57" title="All 2 branches missed.">		for (int i = 1; i &lt; _participantCount; i++) {</span>
<span class="nc" id="L58">			Participant cpuParticipant = new Participant();</span>
<span class="nc" id="L59">			GiveParticipantInitialCards(cpuParticipant, _participantCount);</span>
<span class="nc" id="L60">			_cpuPlayers.add(cpuParticipant);</span>
<span class="nc" id="L61">			_aliveParticipants.add(cpuParticipant);</span>
		}
<span class="nc" id="L63">	}</span>





	private static void GiveParticipantInitialCards(Participant participant, int participantCount) {
<span class="nc" id="L70">		int cardsToGiveToParticipant = CARDS_IN_DECK / participantCount;</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">		assert (cardsToGiveToParticipant * participantCount &lt;= CARDS_IN_DECK);</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">		for (int i = 0; i &lt; cardsToGiveToParticipant; i++) {</span>
<span class="nc" id="L73">			HaliCard cardFromDeck = _deck.TakeCardFromDeck();</span>

			// In initial state, there must be enough cards for everyone.
<span class="nc bnc" id="L76" title="All 2 branches missed.">			assert (cardFromDeck != null);</span>
<span class="nc" id="L77">			participant.AddCard_ToBottomOfHands(cardFromDeck);</span>
		}
<span class="nc" id="L79">	}</span>





	private static void PlayGame(Participant player) {
<span class="nc" id="L86">		boolean gameIsDone = false;</span>

		// ::: Player is always 0
		// ::: Whoever starts first is random
<span class="nc" id="L90">		int currentPlayerTurn = new Random().nextInt(_participantCount);</span>

		// TODO: Refresh the terminal, then display UI elements on the top of the screen that show the controls, every
		// round.

<span class="nc bnc" id="L95" title="All 2 branches missed.">		while (!gameIsDone) {</span>
			
<span class="nc bnc" id="L97" title="All 2 branches missed.">			if (_aliveParticipants.size() == 1) {</span>
<span class="nc" id="L98">				gameIsDone = true;</span>
<span class="nc" id="L99">				Participant winner = _aliveParticipants.get(0);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">				String winnerString = (_aliveParticipants.get(0) == _player) ? &quot;Player&quot; : &quot;CPU&quot;;</span>
<span class="nc" id="L101">				System.out.println(winnerString + &quot;Wins!&quot;);</span>
			}


			// ::: The idea
            /*
            Each round consists of two parts:
                1. Waiting for the current player to place a card

                2. If there is a combination for 5 fruits of the same type, wait until someone presses spacebar.
                   If there is no combination for 5 fruits of the same type, wait for 2 seconds, then go to the next round.
             */

			

<span class="nc" id="L116">			waitForPlayerCard(currentPlayerTurn, player);</span>
<span class="nc" id="L117">			PrintCurrentTableCards();</span>
<span class="nc" id="L118">			waitForBell();</span>

			// TODO: Kicking out dead participants should only happen upon a bell smack.
			// This is to ensure that dead players don't have any cards laying around on the table.
			// Draw a diagram to figure out how this should interact with currentPlayerTurn
			// As it stands, this is wrong and bugged.

<span class="nc" id="L125">			currentPlayerTurn += 1;</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">			if (currentPlayerTurn &gt; (_participantCount - 1)) {</span>
<span class="nc" id="L127">				currentPlayerTurn = 0;</span>
			}
		}
<span class="nc" id="L130">	}</span>



	// To be called when a player smacks the bell and there are precisely 5 fruits of the same type on the table.
	public static void GrabAllTableCards(Participant winner) {
<span class="fc bfc" id="L136" title="All 2 branches covered.">		for (Participant p : _aliveParticipants) {</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">			while (!p.TableCards.isEmpty()) {</span>
<span class="fc" id="L138">				HaliCard card = p.TableCards.pop();</span>
<span class="fc" id="L139">				winner.AddCard_ToBottomOfHands(card);</span>
<span class="fc" id="L140">			}</span>
<span class="fc" id="L141">		}</span>

<span class="pc bpc" id="L143" title="1 of 2 branches missed.">		System.out.println(((winner == _player) ? &quot;Player&quot; : &quot;CPU&quot;) + &quot; grabbed all the table cards!&quot;);</span>
		
<span class="fc" id="L145">		KickOutDeadParticipants();</span>
<span class="fc" id="L146">	}</span>


	// Players can only die when someone has 
	private static void KickOutDeadParticipants() {
<span class="fc" id="L151">		ArrayList&lt;Participant&gt; eliminated = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L153" title="All 2 branches covered.">		for (Participant p : _aliveParticipants) {</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">			if (!p.HasACard()) {</span>
<span class="fc" id="L155">				eliminated.add(p);</span>
			}
<span class="fc" id="L157">		}</span>

<span class="fc" id="L159">		_aliveParticipants.removeAll(eliminated);</span>
<span class="pc bnc" id="L160" title="All 2 branches missed.">		_cpuPlayers.removeIf(cpu -&gt; !cpu.HasACard());</span>

<span class="fc bfc" id="L162" title="All 2 branches covered.">		for (Participant p : eliminated) {</span>
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">			String who = (p == _player) ? &quot;Player&quot; : &quot;CPU&quot;;</span>
<span class="fc" id="L164">			System.out.println(who + &quot; has been eliminated.&quot;);</span>
<span class="fc" id="L165">		}</span>
<span class="fc" id="L166">	}</span>

	/// Placing a card
	private static void waitForPlayerCard(int currentPlayerTurn, Participant player) {
		// ::: Player Turn
<span class="nc bnc" id="L171" title="All 2 branches missed.">		if (currentPlayerTurn == 0) {</span>
			// ::: Wait for player to press enter, then place card.
<span class="nc" id="L173">			System.out.print(&quot;Player Turn! (Press enter to place a card.&quot;);</span>
<span class="nc" id="L174">			SleepHack(1000);</span>

<span class="nc" id="L176">			_inputScanner.nextLine();</span>
<span class="nc" id="L177">			player.PutCardOnTable();</span>
			// TODO: Skip turn if you have no cards.

<span class="nc" id="L180">			System.out.println(&quot;Player put &quot; + player.TableCards.peek().fruitType +</span>
<span class="nc" id="L181">					  &quot; &quot; + player.TableCards.peek().count +</span>
					  &quot; on the table.&quot;);

		}

		// ::: CPU Turn
		else {
<span class="nc" id="L188">			System.out.println(&quot;CPU &quot; + (currentPlayerTurn) + &quot;'s turn!&quot;);</span>
<span class="nc" id="L189">			SleepHack(1000);</span>

<span class="nc" id="L191">			Participant activeCpu = _cpuPlayers.get(currentPlayerTurn - 1);</span>
<span class="nc" id="L192">			activeCpu.PutCardOnTable();</span>
<span class="nc" id="L193">			HaliCard cpuNewCard = activeCpu.TableCards.peek();</span>
<span class="nc" id="L194">			out.println(&quot;CPU &quot; + (currentPlayerTurn) + &quot; put &quot; + cpuNewCard.fruitType + &quot; &quot; + cpuNewCard.count+ &quot; on the table.&quot;);</span>
		}
<span class="nc" id="L196">	}</span>

	private static void PrintCurrentTableCards() {
<span class="nc" id="L199">		out.println(&quot;\n---The Cards on the Table---&quot;);</span>


		// ::: Reading the card data from the player and CPUs.
<span class="nc" id="L203">		HaliCard pCard = null;</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">		if (!_player.TableCards.isEmpty()) {</span>
<span class="nc" id="L205">			pCard = _player.TableCards.peek();</span>
		}

<span class="nc bnc" id="L208" title="All 2 branches missed.">		if (pCard != null) {</span>
<span class="nc" id="L209">			out.println(&quot;Player: &quot; + pCard.fruitType + &quot; &quot; + pCard.count);</span>
		}

<span class="nc bnc" id="L212" title="All 2 branches missed.">		for (int i = 0; i &lt; _participantCount - 1; i++) {</span>
<span class="nc" id="L213">			HaliCard cCard = null;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">			if (!_cpuPlayers.get(i).TableCards.isEmpty()) {</span>
<span class="nc" id="L215">				cCard = _cpuPlayers.get(i).TableCards.peek();</span>
			}
<span class="nc bnc" id="L217" title="All 2 branches missed.">			if (cCard != null) {</span>
<span class="nc" id="L218">				out.println(&quot;CPU &quot; + (i + 1) + &quot;: &quot; + cCard.fruitType + &quot; &quot; + cCard.count);</span>
			}
		}

<span class="nc" id="L222">		out.println(&quot;---\n&quot;);</span>
<span class="nc" id="L223">	}</span>

	private static void SleepHack(int msSleepTime) {
		try { 
<span class="nc" id="L227">			Thread.sleep(msSleepTime);</span>

<span class="nc" id="L229">		} catch (Exception e) {</span>
<span class="nc" id="L230">			out.println(&quot;This code has no business being triggered. The game is broken&quot;);</span>
<span class="nc" id="L231">		}</span>
<span class="nc" id="L232">	}</span>

	/// Seeing who will smack the bell first within a 3 second window.
	private static void waitForBell() {
<span class="nc" id="L236">		boolean exactlyFiveOfFruitArePresent = AreFiveFruitsPresent();</span>


		// TODO: Multithreading, or some other solution, to solve the problem of 
		// the player needing to be able to press Enter to smack the bell, 
		// while at any time during the 3 second window, the CPUs can do it too. 

<span class="nc bnc" id="L243" title="All 2 branches missed.">		if (AreFiveFruitsPresent()) {</span>
			// ::: Bell is valid. Waiting until one of the participants smacks the bell.
<span class="nc" id="L245">			out.println(&quot;5 fruits were present, but handling that is currently unimplemented&quot;);</span>
		} else {
			// ::: Bell is invalid. Computing a chance that a CPU smacks the bell on accident anyway.
<span class="nc bnc" id="L248" title="All 2 branches missed.">			boolean cpuSmacksBell = new Random().nextInt(0, 10) == 0; // 10% chance that a cpu smacks bell.</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">			if (cpuSmacksBell) {</span>
				// ::: Retroactively deciding which CPU smacked the bell :)
<span class="nc" id="L251">				int bellSmackerIndex = new Random().nextInt(0, _participantCount - 1);</span>
<span class="nc" id="L252">				out.println(&quot;Cpu &quot; + (bellSmackerIndex + 1) + &quot; messed up!&quot;);</span>
<span class="nc" id="L253">				HandleWrongBellSmack(_cpuPlayers.get(bellSmackerIndex));</span>
			}
		}
		
		
		// TODO: Remove this while implementing the function properly.
<span class="nc" id="L259">		SleepHack(3000);</span>
<span class="nc" id="L260">	}</span>





	private static void HandleWrongBellSmack(Participant victim) {
<span class="nc bnc" id="L267" title="All 2 branches missed.">		for (Participant nonVictim : _aliveParticipants) {</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">			if (nonVictim != victim) {</span>
<span class="nc" id="L269">				HaliCard takenCard = victim.RemoveCard_FromHandTop();</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">				if (takenCard == null) {</span>
<span class="nc" id="L271">					break;</span>
				}
<span class="nc" id="L273">				nonVictim.AddCard_ToBottomOfHands(takenCard);</span>
<span class="nc" id="L274">				out.println(&quot;A card was given to another player.&quot;);</span>
			}
<span class="nc" id="L276">		}</span>
<span class="nc" id="L277">	}</span>


	public static boolean AreFiveFruitsPresent() {
		// ::: Idea: Go over all alive players, and read their fruits. Check for matches of 5.
		// Since there is such a limited amount of fruits, I hardcode it here. A more dynamic approach with
		// a hashtable would be suited if there was a significantly greater variety of card types.
<span class="nc" id="L284">		int bananaCount = 0;</span>
<span class="nc" id="L285">		int strawberryCount = 0;</span>
<span class="nc" id="L286">		int plumeCount = 0;</span>
<span class="nc" id="L287">		int limeCount = 0;</span>

<span class="nc bnc" id="L289" title="All 2 branches missed.">		for (Participant aliveParticipant : _aliveParticipants) {</span>
<span class="nc" id="L290">			HaliCard tableCard = null;</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">			if (!aliveParticipant.TableCards.isEmpty()) {</span>
<span class="nc" id="L292">				tableCard = aliveParticipant.TableCards.peek();</span>
			}
<span class="nc bnc" id="L294" title="All 2 branches missed.">			if (tableCard == null) {</span>
<span class="nc" id="L295">				continue;</span>
			}

<span class="nc bnc" id="L298" title="All 5 branches missed.">			switch (tableCard.fruitType) {</span>
				case Banana:
<span class="nc" id="L300">					bananaCount += tableCard.count;</span>
<span class="nc" id="L301">					break;</span>
				case Lime:
<span class="nc" id="L303">					limeCount += tableCard.count;</span>
<span class="nc" id="L304">					break;</span>
				case Strawberry:
<span class="nc" id="L306">					strawberryCount += tableCard.count;</span>
<span class="nc" id="L307">					break;</span>
				case Plum:
<span class="nc" id="L309">					plumeCount += tableCard.count;</span>
					break;
			}
<span class="nc" id="L312">		}</span>
<span class="nc bnc" id="L313" title="All 8 branches missed.">		return (</span>
				  bananaCount == 5 ||
							 strawberryCount == 5 ||
							 plumeCount == 5 ||
							 limeCount == 5
		);
	}

	private static void ResetGame() {
<span class="nc" id="L322">		_cpuPlayers.clear();</span>
<span class="nc" id="L323">		_aliveParticipants.clear();</span>

<span class="nc" id="L325">		_deck = new HaliDeck();</span>
<span class="nc" id="L326">		_player = new Participant();</span>
<span class="nc" id="L327">		_aliveParticipants.add(_player);</span>

<span class="nc" id="L329">		GiveParticipantInitialCards(_player, _participantCount);</span>

<span class="nc bnc" id="L331" title="All 2 branches missed.">		for (int i = 1; i &lt; _participantCount; i++) {</span>
<span class="nc" id="L332">			Participant cpu = new Participant();</span>
<span class="nc" id="L333">			GiveParticipantInitialCards(cpu, _participantCount);</span>
<span class="nc" id="L334">			_cpuPlayers.add(cpu);</span>
<span class="nc" id="L335">			_aliveParticipants.add(cpu);</span>
		}

<span class="nc" id="L338">		System.out.println(&quot;\nGame has been reset!\n&quot;);</span>
<span class="nc" id="L339">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>